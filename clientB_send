import socket
import select

serverName = '192.168.19.15'
serverPort = 12020
clientSocket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
#clientSocket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)
clientSocket.connect((serverName,serverPort))

print 'log in '
#receive username & password
name = raw_input('username : ')
clientSocket.send(name)

passkey = clientSocket.recv(1024)
if (passkey == '01'):
    passwd = raw_input('password : ')
    clientSocket.send(passwd)
    passkey = clientSocket.recv(1024)
    if (passkey == '02'):
        print 'user login success!'

        print 'command mode: '
        command_rec = raw_input('(1)chatting mode\n(2)list all user\n(3)broadcast\n(4)log out\n')
        if command_rec == '1':
            clientSocket.send(command_rec)
            chat_user = raw_input('choose user: ')
            clientSocket.send(chat_user)
            msg = raw_input('msg : ')
            msg = 'send' + ' ' + chat_user + ' ' + msg
            clientSocket.send(msg)
        elif command_rec == '2':
            clientSocket.send(command_rec)
            print 'list user'
            onlie_num = clientSocket.recv(1024)
            print onlie_num 
            for k in range(int(onlie_num)):
                onlinelist = clientSocket.recv(1024)
                print onlinelist
        elif command_rec == '3':
            message = clientSocket.recv(1024)
            print message
        elif command_rec == '4':
            clientSocket.send(command_rec)
    else:
        print 'error password'
else:
    print 'error user'


clientSocket.close()
